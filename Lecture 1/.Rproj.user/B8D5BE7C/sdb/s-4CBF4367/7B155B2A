{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Lecture 1\" \nsubtitle: \"Spatio-temporal data & Linear Models\"\nauthor: \"Colin Rundel\"\ndate: \"1/18/2017\"\nfontsize: 11pt\noutput: \n  beamer_presentation:\n    theme: metropolis\n    highlight: pygments\n    fig_height: 6\n    fig_caption: FALSE\n    latex_engine: xelatex\n    includes:\n      in_header: ../settings.tex\n---\n\n```{r setup, include=FALSE}\nlibrary(sf)\nlibrary(zoo)\nlibrary(quantmod)\nlibrary(sp)\nlibrary(lubridate)\nlibrary(MASS)\nlibrary(dplyr)\n```\n\n# Spatio-temporal data\n\n\n## Time Series Data - Discrete\n    \n```{r echo=FALSE, fig.align='center', message=FALSE}\nx = getSymbols(\"^GSPC\", src = \"yahoo\", from = as.Date(\"2017-01-01\"))\nsuppressWarnings(plot(GSPC, main='S&P 500 Open (^GSPC)', type='b'))\n```\n\n\n## Time Series Data - Continuous\n  \n```{r echo=FALSE}\nload(\"data/frn_example.Rdata\")\n\npm25 = pm25 %>% \n  transmute(date = mdy(Date), pm25 = PM25) %>%\n  filter(month(date) %in% 1:2)\n\npar(mar=c(4,5,4,4))\nplot(pm25, type='b', xlab=\"\", main=\"FRN Measured PM25\", ylab=expression(paste(\"PM25 (\", mu, \"g/\", m^3,\")\")))\n```\n\n\n## Spatial Data - Areal\n    \n```{r echo=FALSE}\nnc = st_read(system.file(\"shape/nc.shp\", package=\"sf\"), quiet = TRUE)\nnc = select(nc, SID79, geometry)\nplot(nc, axes=TRUE)\n```\n\n## Spatial Data - Point referenced\n    \n```{r echo=FALSE}\ndata(meuse)\ncoordinates(meuse) = ~x+y\nm.sf = st_as_sf(meuse)\n\ndata(meuse.riv)\nmeuse.sr = SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)), \"x\"))) %>% st_as_sf()\n\n\nopar = par(oma=c(4,4,4,4), mfrow=c(1,3), mar=c(1,2,3,2))\nfor(i in 2:4)\n{\n    plot(m.sf %>% select_(i,'geometry'), pch=16, axes=TRUE)\n    plot(meuse.sr, add=TRUE, col='lightblue')\n}\n\nmtext('Meuse River', outer=TRUE, line=2, cex=1.5)\n```\n\n## Point Pattern Data - Time\n   \n```{r echo=FALSE}\nold_faithful = geyser %>% \n  mutate(time = cumsum(waiting)+cumsum(lag(duration,default=0))) %>% \n  dplyr::select(time, duration) %>% \n  slice(1:25)\n\nplot(old_faithful, type='b', main=\"Old Faithful Eruption Duration\")\n```\n\n\n## Point Pattern Data - Space\n    \n\\begin{center}\n\\includegraphics[width=0.6\\textwidth]{figs/fires.png}\n\\end{center}\n\n\n## Point Pattern Data - Space + Time\n        \n\\begin{center}\n\\includegraphics[width=\\textwidth]{figs/earthquakes.png}\n\\end{center}\n\n\n# (Bayesian) Linear Models\n\n## Linear Models\n\nPretty much everything we a going to see in this course will fall under the umbrella of linear or generalized linear models. \n\n$$ \n\\begin{aligned}\nY_i &= \\beta_0 + \\beta_1 \\, x_{i1} + \\cdots + \\beta_p \\, x_{ip} + \\epsilon_i  \\\\\n\\epsilon_i &\\sim N(0, \\sigma^2)\n\\end{aligned}\n$$\nwhich we can also express using matrix notation as \n\n$$\n\\begin{aligned}\n\\underset{n \\times 1}{\\bm{Y}} &= \\underset{n \\times p}{\\bm{X}} \\, \\underset{p \\times 1}{\\bm{\\beta}} + \\underset{n \\times 1}{\\bm{\\epsilon}} \\\\\n\\bm{\\epsilon} &\\sim N(\\underset{n \\times 1}{\\bm{0}}, \\; \\sigma^2 \\underset{n \\times n}{\\mathbbm{I}_n})\n\\end{aligned}\n$$\n\n\n## Multivariate Normal Distribution\n\nFor an $n$-dimension multivate normal distribution with covariance $\\bm{\\Sigma}$ (positive semidefinite) can be written as\n\n$$\n\\underset{n \\times 1}{\\bm{Y}} \\sim N(\\underset{n \\times 1}{\\bm{\\mu}}, \\; \\underset{n \\times n}{\\bm{\\Sigma}}) \\text{ where } \\{\\bm{\\Sigma}\\}_{ij} = \\rho_{ij} \\sigma_i \\sigma_j\n$$\n\n$$\n\\begin{pmatrix}\nY_1\\\\ \\vdots\\\\ Y_n\n\\end{pmatrix}\n\\sim N\\left(\n\\begin{pmatrix}\n\\mu_1\\\\ \\vdots\\\\ \\mu_n\n\\end{pmatrix}, \\,\n\\begin{pmatrix}\n\\rho_{11}\\sigma_1\\sigma_1 & \\cdots & \\rho_{1n}\\sigma_1\\sigma_n \\\\\n\\vdots & \\ddots & \\vdots \\\\\n\\rho_{n1}\\sigma_n\\sigma_1 & \\cdots & \\rho_{nn}\\sigma_n\\sigma_n \\\\\n\\end{pmatrix}\n\\right)\n$$\n\n\n## Multivariate Normal Distribution - Density\n\nFor the $n$ dimensional multivate normal given on the last slide, its density is given by\n\n$$\n(2\\pi)^{-n/2} \\; \\det(\\bm{\\Sigma})^{-1/2} \\; \\exp{\\left(-\\frac{1}{2} \\underset{1 \\times n}{(\\bm{Y}-\\bm{\\mu})'} \\underset{n \\times n}{\\bm{\\Sigma}^{-1}} \\underset{n \\times 1}{(\\bm{Y}-\\bm{\\mu})}\\right)} \n$$\n\nand its log density is given by\n\n$$\n-\\frac{n}{2} \\log 2\\pi - \\frac{1}{2} \\log \\det(\\bm{\\Sigma}) - -\\frac{1}{2} \\underset{1 \\times n}{(\\bm{Y}-\\bm{\\mu})'} \\underset{n \\times n}{\\bm{\\Sigma}^{-1}} \\underset{n \\times 1}{(\\bm{Y}-\\bm{\\mu})}\n$$\n\n\n## A Simple Linear Regression Example\n\nLets generate some simulated data where the underlying model is known and see how various regression preceedures function.\n\n$$ \\beta_0 = 0.7, \\quad \\beta_1 = 1.5, \\quad \\beta_2 = -2.2, \\quad \\beta_3 = 0.1 $$\n$$ n=100, \\quad \\epsilon_i \\sim N(0,1) $$\n\n\n## Generating the data\n\n```{r}\nset.seed(01172017)\nn = 100\nbeta = c(0.7,1.5,-2.2,0.1)\neps = rnorm(n)\n\nX0 = rep(1, n)\nX1 = rt(n,df=5)\nX2 = rt(n,df=5)\nX3 = rt(n,df=5)\n\nX = cbind(X0, X1, X2, X3)\nY = X %*% beta + eps\nd = data.frame(Y,X[,-1]) \n```\n\n\n\n## Least squares fit\n\nLet $\\hat{\\bm{Y}}$ be our estimate for $\\bm{Y}$ based on our estimate of $\\bm{\\beta}$,\n$$ \\hat{\\bm{Y}} = \\hat{\\beta}_0 + \\hat{\\beta}_1 \\, \\bm{X}_{1} + \\hat{\\beta}_2 \\, \\bm{X}_{2} + \\hat{\\beta}_3 \\, \\bm{X}_{3} = \\bm{X}\\, \\hat{\\bm{\\beta}} $$\n\n. . .\n\nThe least squares estimate, $\\hat{\\bm{\\beta}}_{ls}$, is given by\n$$ \\underset{\\bm{\\beta}}{\\argmin} \\sum_{i=1}^n \\left( Y_i - \\bm{X}_{i\\cdot} \\bm{\\beta} \\right)^2 $$\n\n. . .\n\nWith a bit of calculus and algebra we can derive\n$$ \\hat{\\bm{\\beta}}_{ls} = (\\bm{X}^t \\bm{X})^{-1} \\bm{X}^t \\, \\bm{Y} $$\n\n## Maximum Likelihood\n\n\n\n## Frequentist Fit\n\n```{r}\nlm(Y ~ ., data=d)$coefficients\n\n(beta_hat = solve(t(X) %*% X, t(X)) %*% Y)\n```\n\n\n## Bayesian Model \n\n$$\nY_1, \\, \\ldots, \\, Y_{100} \\,|\\, \\bm{\\beta}, \\, \\sigma^2 \\sim N(\\bm{X}_{i\\cdot}\\bm{\\beta},\\, \\sigma^2)\n$$\n\n$$ \\beta_0,\\, \\beta_1,\\, \\beta_2,\\, \\beta_3 \\sim N(0, \\sigma^2_\\beta = 100) $$\n\n$$ \\tau^2 = 1/\\sigma^2 \\sim \\text{Gamma}(a=1,\\,b=1) $$\n\n## Deriving the posterior\n\n$$ [\\beta_0, \\beta_1, \\beta_2, \\beta_3, \\sigma^2 \\,|\\, \\bm{Y}\\,] = \\frac{[\\bm{Y} \\,|\\, \\bm{\\beta}, \\sigma^2]}{[\\bm{Y}\\,]} [\\bm{\\beta}, \\sigma^2] $$\n$$ \\propto [\\bm{Y} \\,|\\, \\bm{\\beta}, \\sigma^2] [\\bm{\\beta}] [\\sigma^2] $$\n\n. . . \n\nwhere, \n\n$$ [\\bm{Y} \\,|\\, \\bm{\\beta}, \\sigma^2] = \n\\left(2\\pi \\sigma^2\\right)^{-n/2} \\exp\\left( -\\frac{\\sum_{i=1}^n \\left(Y_i-\\beta_0-\\beta_1 X_{i,1}-\\beta_1 X_{i,2} -\\beta_3 X_{i,3}  \\right)^2}{2\\sigma^2} \\right) $$\n\n. . .\n\n$$ [\\beta_0,\\beta_1,\\beta_2,\\beta_3 \\,|\\, \\sigma^2_\\beta] = (2\\pi \\sigma^2_\\beta)^{-4/2} \\exp\\left( -\\frac{\\sum_{i=0}^3\\beta^2_i}{2\\sigma^2_\\beta} \\right) $$\n\n. . .\n\n$$ [\\sigma^2 \\,|\\, a,\\, b] = \\frac{b^a}{\\Gamma(a)} (\\sigma^2)^{-a-1} \\exp\\left( -\\frac{b}{\\sigma^2} \\right) $$\n\n## Deriving the posterior (cont.)\n\n$$\n\\begin{aligned}\n\\lbrack \\beta_0, \\beta_1, \\,&\\beta_2, \\beta_3, \\sigma^2 \\,|\\, \\bm{Y} \\, \\rbrack  \\propto \\\\\n  &\\left(2\\pi \\sigma^2\\right)^{-n/2} \\exp\\left( -\\frac{\\sum_{i=1}^n \\left(Y_i-\\beta_0-\\beta_1 X_{i,1}-\\beta_1 X_{i,2} -\\beta_3 X_{i,3}  \\right)^2}{2\\sigma^2} \\right) \\\\\n  &(2\\pi \\sigma^2_\\beta)^{-4/2} \\exp\\left( -\\frac{\\beta^2_0+\\beta^2_1+\\beta^2_2+\\beta^2_3}{2\\sigma^2_\\beta} \\right) \\\\\n  &\\frac{b^a}{\\Gamma(a)} (\\sigma^2)^{-a-1} \\exp\\left( -\\frac{b}{\\sigma^2} \\right) \n\\end{aligned}\n$$\n\n## Deriving the Gibbs sampler ($\\sigma^2$ step)\n\n<!-- -->\n\n\n## Deriving the Gibbs sampler ($\\beta_i$ step)\n\n<!-- -->",
    "created" : 1484624354629.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3878839109",
    "id" : "7B155B2A",
    "lastKnownWriteTime" : 1484766121,
    "last_content_update" : 1484766121297,
    "path" : "~/Desktop/Sta444/Lectures/Lecture 1/Lec1.Rmd",
    "project_path" : "Lec1.Rmd",
    "properties" : {
        "last_setup_crc32" : ""
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}